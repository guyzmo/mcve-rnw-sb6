import React, { useState } from "react";

import { useAuth } from "@zeloce/api";
import { Text, Button, Container, Input } from "../components";

const LoginScreen = ({ switchForm = () => {} }) => {
  const {
    setIsAuthenticated,
    setIsUser,
    signinGetCode,
    signinCheckCode,
  } = useAuth();

  const [inputValue, setInputValue] = useState<string>("");

  const handleLogin = ({ phone, code }) => {
    if (!!phone && !!code) {
      signinCheckCode(phone.replace(/^0/, "+33"), code).then((result) => {
        console.log(result);
        if (result.data !== null) {
          setIsAuthenticated(true);
          setIsUser(true);
        } else {
          console.error("Téléphone ou code inconnu !", {
            position: "top-center",
          });
        }
      });
    } else if (!!phone && !code) {
      signinGetCode(phone.replace(/^0/, "+33"));
    }
    return false;
  };

  return (
    <Container bgColor="primary" bgShade={500}>
      <Text>
        Bienvenue !
      </Text>
      <Text>Identifiez-vous pour continuer</Text>
      <Input
        value={inputValue}
        placeholder="Numéro de téléphone"
        onChangeText={(text: string) => setInputValue(text)}
      />
      <Button
        onPress={() => {
          handleLogin({ phone: "0600000000", code: "314159" });
        }}
      >
        <Text>Se connecter</Text>
      </Button>
    </Container>
  );
};

export default LoginScreen;
